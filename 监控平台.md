## Linux 监控
0、常见的监控软件
> cacti, nagios, zabbix, smokeping, open-falcon,prometheus,grafana 

## 1、zabbix 监控介绍
> 基于web的开源软件，开源监控系统状态也可以监控网络设备。Zabbix 可以自动发现主机和网络设备，支持邮件和短信告警。  
> C/S 架构，基于 C++ 开发，监控中心支持 web 界面配置和管理，单 server 节点可以支持上万台客户端

5 个组件：
- zabbix-server 监控中心，接收客户端上报信息，负责配置、统计、操作数据
- web UI 在 web 界面下操作配置是 zabbix 简单易用的主要原因
- zabbix-proxy 可选组件，可以代替 zabbix-server 的功能，减轻 server 的压力
- zabbix-agent 客户端软件，负责采集各个监控服务或项目的数据并上报
- 数据存储，存放数据，如 mysql

## 2、zabbix 4.0 安装
```bash
$ rpm -Uvh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm
$ yum clean all
$ yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agent [zabbix-get zabbix-web]
$ mysql -uroot -p
$ mysql> create database zabbix;
$ mysql> grant all privileges on zabbix.* to zabbix@'127.0.0.1' identified by 'password';

$ vim /etc/zabbix/zabbix_server.conf
93  DBHost=127.0.0.1
128 DBPassword=xing/*-

$ zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -h127.0.0.1 -p zabbix
$ vim /etc/httpd/conf.d/zabbix.conf
20 php_value date.timezone Asia/Shanghai

# vim /etc/php.ini
# 878 date.timezone = Asia/Shanghai

$ vim /etc/zabbix/zabbix_agentd.conf
98 Server=127.0.0.1 //白名单，主动模式，默认 server 会到 agent 端取数据
139 ServerActive=127.0.0.1 //被动模式

$ systemctl start zabbix-server zabbix-agent httpd
$ systemctl enable zabbix-server zabbix-agent httpd
# zabbix-server 监听端口为10051
# zabbix-agentd 监听端口为10050

# 浏览器 http://192.168.6.165/zabbix 安装
# The default user name is Admin, password zabbix.
```
```bash
# 客户端只需安装 zabbix-agent
$ rpm -Uvh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm
$ yum install zabbix-agent -y
$ vim /etc/zabbix/zabbix_agentd.conf
98 Server=192.168.6.165 //服务端IP
139 ServerActive=192.168.6.165

$ systemctl start zabbix-agent
$ iptables -I INPUT -s 192.168.6.165 -j ACCEPT //或者放行 10050 端口
```

## 3、监控客户机
> Configuration --> Host groups

> Configuration --> Hosts --> Create Host
1. Host name:Tester
2. Groups:Linux servers
3. Agent interfaces:IP address:192.168.6.128 Port:10050

> Configuration --> Templates --> Create Template
1. Template name:test
2. Groups:Templates
3. Items --> Copy --> Templates Target:test（进入一个 Templates --> Full clone 一个新模板）

> 进入新增的监控主机 --> Templates --> Link new templates:test --> Add

> Monitoring --> Latest data --> Hosts:Tester --> Apply


