## Linux 监控
0、常见的监控软件
> cacti, nagios, zabbix, smokeping, open-falcon,prometheus,grafana 

cacti, smokeping 偏向于基础监控，成图漂亮

cacti, nagios, zabbix 服务端监控中心，需要 php 环境支持，zabbix 和 cacti 都需要 mysql 作为数据存储，nagios 不用存储历史数据，注重服务或者监控项的状态，zabbix 会获取服务或者监控项目的数据，会把数据记录到数据库里，从而可以成图

open-falcon 为小米公司开发，开源后受到很多大公司和运维工程师的追捧，适合大企业，如滴滴，360，新浪微博，京东在使用

1、监控介绍
cacti (rrdtools 画图用) 优势 监控网络设备 路由器流量等 用 mysql

nagios 监控服务状态 内存是否写满，服务是否死掉 特点 不会记录历史数据 自己写脚本 报警邮件，短信

zabbix 最丰富 支持查看历史数据 画图 报警 自动发现设备 用 mysql

2、cacti 安装
http://ask.apelearn.com/question/7418

包括后面的都需要 epel 源

一、 安装 cacti服务端
\1. 首先要安装epel扩展源
rpm -ivh http://www.aminglinux.com/bbs/da … ease-6-7.noarch.rpm
\2. （lamp）然后分别安装httpd、php、mysql
yum install -y httpd php php-mysql mysql mysql-server mysql-devel php-gd libjpeg libjpeg-devel libpng libpng-devel
\3. 安装cacti net-snmp rrdtool
yum install -y cacti net-snmp net-snmp-utils rrdtool
\4. 启动服务：
/etc/init.d/mysqld start
/etc/init.d/httpd start
/etc/init.d/snmpd start
\5. 编辑httpd配置文件
vim /etc/httpd/conf.d/cacti.conf
把"Deny from all" 改为 “Allow from all”
/etc/init.d/httpd restart
6. 导入数据创建cacti库
mysql -uroot -e “create database cacti”
创建cacti用户
mysql -uroot -e “grant all on cacti.* to ‘cacti’@‘127.0.0.1’ identified by ‘cacti’;”
导入sql文件
mysql -uroot cacti < /usr/share/doc/cacti-0.8.8b/cacti.sql
7. 编辑cacti配置文件
vim /usr/share/cacti/include/config.php 更改如下：
$database_type = “mysql”;
$database_default = “cacti”;
$database_hostname = “127.0.0.1”;
$database_username = “cacti”;
$database_password = “cacti”;
$database_port = “3306”;
$database_ssl = false;
\8. web访问cacti并安装
http://ip/cacti/
点两下“next” 和一次”Finish“ 即可
输入admin admin 登录，重新设置新的密码
\9. 执行poller.php, 生成图形， 加入计划任务
/usr/bin/php /usr/share/cacti/poller.php添加cron任务
cront -e 增加：
*/5 * * * * /usr/bin/php /usr/share/cacti/poller.php

3、cacti 增加客户端监控
二、 安装客户端（增加一个linux服务器）
\1. 安装snmp
yum install -y net-snmp
\2. 修改snmpd.conf
修改syslocation以及syscontact, 其中syslocation 可以写本机ip，syscontact写管理员邮箱
syslocation 11.20
syscontact Root 1212@1212.com
\3. 启动snmp
service snmpd start
4. 登录cacti管理后台，点console , 再点Device， 在右上角点”Add“
Description 写本机ip或你自定义一个名字
Hostname 写本机ip
Host Template 选ucd/net SNMP Host
SNMP Version 选Version 2
点右下角的create
点右上角的”Create Graphs for this Host“
Graph Types: 选择SNMP - Interface Statistics
在下面框中选择要监控的网卡，比如我选择eth0, 在最右侧小方块里打对勾，然后点右下角的create
Graph Types: 再选择 Graph Template Based
在下面的框中，选择你要监控的项目，比如ucd/net - Load Average
在右侧小方块中打对勾，然后点右下角的create
\5. 点左侧的Graph Trees
选中”Default Tree“
点右上角的Add
Tree Item Type 选择 ”Host“
Host 选择我们刚刚增加的那个机器ip
点右下角的create
\6. 点左上角的Graphs
在左侧可以看到
Defaut Tree下面已经增加了我们刚刚添加的主机，图形一开始不会那么快出来，要等一小会才可以。

cacti有图无数据参数设定
4、nagios 安装
http://ask.apelearn.com/question/7155

http://ask.apelearn.com/question/8087

\1. Nagios 简介
是一个开源软件，可以监控网络设备网络流量、Linux/windows主机状态，甚至可以监控打印机
它可以运行在Linux上或windows上
基于浏览器的web界面方便运维人员查看监控项目的状态
支持web界面配置、管理操作
支持短信、邮件通知
可以自定义脚本实现自定义化监控
Nagios官网 http://www.nagios.org
\2. Nagios安装 - 服务端（192.168.0.11）
Centos6默认的yum源里没有nagios相关的rpm包，但是我们可以安装一个epel的扩展源：
rpm -ivh http://www.aminglinux.com/bbs/data/attachment/forum/month_1211/epel-release-6-7.noarch.rpm
yum install -y httpd nagios nagios-plugins nagios-plugins-all nrpe nagios-plugins-nrpe
设置登录nagios后台的用户和密码：htpasswd -c /etc/nagios/passwd nagiosadmin
vim /etc/nagios/nagios.cfg
nagios -v /etc/nagios/nagios.cfg 检测配置文件
启动服务：service httpd start; service nagios start
浏览器访问： http://ip/nagios

5、nagios 监控客户端
\3. Nagios安装 - 客户端（192.168.0.12）
在客户端机器上 rpm -ivh http://www.aminglinux.com/bbs/data/attachment/forum/month_1211/epel-release-6-7.noarch.rpm
yum install -y nagios-plugins nagios-plugins-all nrpe nagios-plugins-nrpe
vim /etc/nagios/nrpe.cfg 找到“allowed_hosts=127.0.0.1” 改为 “allowed_hosts=127.0.0.1,192.168.0.11” 后面的ip为服务端ip; 找到” dont_blame_nrpe=0” 改为 “dont_blame_nrpe=1”
启动客户端 /etc/init.d/nrpe start
\4. 监控中心（192.168.0.11）添加被监控主机（192.168.0.12）
cd /etc/nagios/conf.d/
vim 192.168.0.12.cfg //加入：

define host{
​ use linux-server ; Name of host template to use
​ ; This host definition will inherit all variables that are defined
​ ; in (or inherited by) the linux-server host template definition.
​ host_name 192.168.0.12
​ alias 0.12
​ address 192.168.0.12
​ }
define service{
​ use generic-service
​ host_name 192.168.0.12
​ service_description check_ping
​ check_command check_ping!100.0,20%!200.0,50%
​ max_check_attempts 5
​ normal_check_interval 1
}
define service{
​ use generic-service
​ host_name 192.168.0.12
​ service_description check_ssh
​ check_command check_ssh
​ max_check_attempts 5
​ normal_check_interval 1
}
define service{
​ use generic-service
​ host_name 192.168.0.12
​ service_description check_http
​ check_command check_http
​ max_check_attempts 5
​ normal_check_interval 1
}
\5. 配置文件的简单说明
我们定义的配置文件中一共监控了三个service：ssh, ping, http 这三个项目是使用本地的nagios工具去连接远程机器，也就是说即使客户端没有安装nagios-plugins以及nrpe也是可以监控到的。其他的一些service诸如负载、磁盘使用等是需要服务端通过nrpe去连接到远程主机获得信息，所以需要远程主机安装nrpe服务以及相应的执行脚本(nagios-plugins)
max_check_attempts 5 #当nagios检测到问题时，一共尝试检测5次都有问题才会告警，如果该数值为1，那么检测到问题立即告警
normal_check_interval 1#重新检测的时间间隔，单位是分钟，默认是3分钟
notification_interval 60 #在服务出现异常后，故障一直没有解决，nagios再次对使用者发出通知的时间。单位是分钟。如果你认为，所有的事件只需要一次通知就够了，可以把这里的选项设为0。
\6. 继续添加服务
服务端vim /etc/nagios/objects/commands.cfg
增加：define command{
command_name check_nrpe
command_line USER1USER1/check_nrpe -H HOSTADDRESSHOSTADDRESS -c ARG1ARG1
}
继续编辑 vim /etc/nagios/conf.d/192.168.0.12.cfg
增加如下内容：

define service{
​ use generic-service
​ host_name 192.168.0.12
​ service_description check_load
​ check_command check_nrpe!check_load
​ max_check_attempts 5
​ normal_check_interval 1
}
define service{
​ use generic-service
​ host_name 192.168.0.12
​ service_description check_disk_hda1
​ check_command check_nrpe!check_hda1
​ max_check_attempts 5
​ normal_check_interval 1
}
define service{
​ use generic-service
​ host_name 192.168.0.12
​ service_description check_disk_hda2
​ check_command check_nrpe!check_hda2
​ max_check_attempts 5
​ normal_check_interval 1
}
check_nrpe!check_load ：这里的check_nrpe就是在commands.cfg刚刚定义的，check_load是远程主机上的一个检测脚本
在远程主机上vim /etc/nagios/nrpe.cfg 搜索check_load，这行就是在服务端上要执行的脚本了，我们可以手动执行这个脚本
把check_hda1更改一下：/dev/hda1 改为 /dev/sda1
再加一行command[check_hda2]=/usr/lib/nagios/plugins/check_disk -w 20% -c 10% -p /dev/sda2
客户端上重启一下nrpe服务: service nrpe restart
服务端也重启一下nagios服务: service nagios restart
7. 配置图形显示 pnp4nagios
（1）安装
yum install pnp4nagios rrdtool
（2）配置主配置文件
vim /etc/nagios/nagios.cfg //修改如下配置

process_performance_data=1
host_perfdata_command=process-host-perfdata
service_perfdata_command=process-service-perfdata
enable_environment_macros=1
（3）修改commands.cfg
vim /etc/nagios/objects/commands.cfg //注释掉原有对process-host-perfdata和process-service-perfdata，重新定义

define command {
​ command_name process-service-perfdata
​ command_line /usr/bin/perl /usr/libexec/pnp4nagios/process_perfdata.pl
}
define command {
​ command_name process-host-perfdata
​ command_line /usr/bin/perl /usr/libexec/pnp4nagios/process_perfdata.pl -d HOSTPERFDATA
}
（4）修改配置文件templates.cfg
vim /etc/nagios/objects/templates.cfg define host {
name hosts-pnp
register 0
action_url /pnp4nagios/index.php/graph?host=HOSTNAMEHOSTNAME&srv=HOST
process_perf_data 1
}
define service {
name srv-pnp
register 0
action_url /pnp4nagios/index.php/graph?host=HOSTNAMEHOSTNAME&srv=SERVICEDESCSERVICEDESC
process_perf_data 1
}
（5）修改host和service配置
vim /etc/nagios/conf.d/192.168.0.12.cfg
把 “define host{
use linux-server”
改为：
define host{
use linux-server,hosts-pnp
修改对应的service，比如
把
define service{
use generic-service
host_name 192.168.0.12
service_description check_disk_hda1
check_command check_nrpe!check_hda1
max_check_attempts 5
normal_check_interval 1
}
改为：
define service{
use generic-service,srv-pnp
host_name 192.168.0.12
service_description check_disk_hda1
check_command check_nrpe!check_hda1
max_check_attempts 5
normal_check_interval 1
}
（6） 重启和启动各个服务：
service nagios restart
service httpd restart
service npcd start
(7) 访问测试
两种访问方法：
ip/nagios/
ip/pnp4nagios/

6、nagios 配置邮件告警
\8. 配置邮件告警
vim /etc/nagios/objects/contacts.cfg //增加：

define contact{
​ contact_name 123
​ use generic-contact
​ alias aming
​ email lishiming2009@139.com
​ }
define contact{
​ contact_name 456
​ use generic-contact
​ alias aaa
​ email aminglinux@139.com
​ }
define contactgroup{
​ contactgroup_name common
​ alias common
​ members 123,456
​ }
然后在要需要告警的服务里面加上contactgroup

define service{
​ use generic-service
​ host_name 192.168.0.12
​ service_description check_load
​ check_command check_nrpe!check_load
​ max_check_attempts 5
​ normal_check_interval 1
​ contact_groups common
}
\9. 几个重要参数说明
notifications_enabled : 是否开启提醒功能。1为开启，0为禁用。一般，这个选项会在主配置文件（nagios.cfg）中定义，效果相同。
notification_interval: 之前刚介绍过，表示重复发送提醒信息的最短间隔时间。默认间隔时间是60分钟。如果这个值设置为0，将不会发送重复提醒。
notification_period: 发送提醒的时间段。非常重要的主机（服务）我定义为24×7，一般的主机（服务）就定义为上班时间。如果不在定义的时间段内，无论什么问题发生，都不会发送提醒。
notification_options: 这个参数定义了发送提醒包括的情况：d = 状态为DOWN, u = 状态为UNREACHABLE , r = 状态恢复为OK , f = flapping。，n=不发送提醒。

7、zabbix 监控介绍
http://ask.apelearn.com/question/7184

基于web的开源软件，开源监控系统状态也可以监控网络设备。Zabbix 可以自动发现主机和网络设备，支持邮件和短信告警。
C/S 架构，基于 C++ 开发，监控中心支持 web 界面配置和管理，单 server 节点可以支持上万台客户端

5 个组件：

zabbix-server 监控中心，接收客户端上报信息，负责配置、统计、操作数据
web UI 在 web 界面下操作配置是 zabbix 简单易用的主要原因
zabbix-proxy 可选组件，可以代替 zabbix-server 的功能，减轻 server 的压力
zabbix-agent 客户端软件，负责采集各个监控服务或项目的数据并上报
数据存储，存放数据，如 mysql
8、zabbix服务端安装
$ rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm
$ yum install zabbix-agent zabbix-server-mysql zabbix-web-mysql zabbix-web zabbix-sender zabbix-get//可通过命令行形式获得监控项目的数据
# 需要按照 lamp 里的步骤安装 mysql
$ vim /etc/my.cnf
 character_set_server=utf8
$ mysql -uroot -p -e  "create database zabbix character set utf8"
$ mysql -uroot -e "grant all on zabbix.* to 'zabbix'@'localhost' identified by 'zabbix';
# $ mysql -uroot -p --default-character-set=utf8 zabbix < /usr/share/zabbix-mysql/schema.sql
# $ mysql -uroot -p --default-character-set=utf8 zabbix < /usr/share/zabbix-mysql/images.sql
# $ mysql -uroot -p --default-character-set=utf8  zabbix < /usr/share/zabbix-mysql/data.sql
$ cd /usr/share/doc/zabbix-server-mysql-3.4.10/
$ gzip -d create.sql.gz
$ mysql -uroot -p zabbix < create.sql

$ systemctl start zabbix-server
$ systemctl start httpd

$ vim /etc/zabbix/zabbix_server.conf
 # DBHost=localhost
 DBHost=127.0.0.1 //mysql 安装机器的 ip
 # DBPassword=
 DBPassword=zabbix
 
$ ps aux | grep zabbix
$ netstat -lntp
网页安装zabbix
# 浏览器访问 http://ip/zabbix
# 默认会有 Time zone for PHP is not set (configuration parameter "date.timezone"). 这样的警告信息
$ vim /etc/php.ini
 date.timezone="Asia/Shanghai"
$ systemctl restart httpd

# Database host 写 127.0.0.1
# 默认管理员账号为 admin:zabbix
安装完成后首先要更改密码

# 有时会遇到“zabbix server is not running”这样的错误，需要编辑一下 /etc/zabbix/zabbix_server.conf ，配置DBUser, DBPassword
重置密码
$ mysql -uroot -p
mysql> use zabbix
mysql> update users set passwd=md5('newpassword') where alias='Admin';
9、zabbix 客户端安装
$ rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm
$ yum install zabbix-agent
$ vim /etc/zabbix/zabbix_agentd.conf
 Server=192.168.95.10 //服务端 ip，被动模式
 ServerActive=192.168.95.10 //服务端 ip，主动模式
 Hostname=zilo-01 //自定义主机名，要唯一，在 web 界面下还要设置同样的主机名
$ systemctl start zabbix-agent
$ systemctl enable zabbix-agent
主动模式和被动模式
主动或被动是相对客户端来讲的
被动模式，服务端会主动连接客户端获取监控项目数据，客户端被动地接受连接，并把监控信息传递给服务端
主动模式，客户端会主动把监控数据汇报给服务端，服务端只负责接收即可
当客户端数量非常多时，建议使用主动模式，可以降低服务端压力
服务端有公网 ip，客户端只有内网 ip，但却能连外网，这种场景适合主动模式
服务端上命令行测试：zabbix_get -s 客户端ip -p10050 -k “system.hostname”

10、zabbix 添加主机
先添加主机组 zilo-test
再添加主机，主机名称和可见名称都写 zilo-01
群组选择 zilo-test
ip 地址写客户端 ip 192.168.95.11
应用集 监控项 触发器 图形 自动发现 web 监测
11、自定义模板
选择自己创建的模板 --> 链接的模板 --> 选择 Template OS Linux --> 添加 --> 更新 --> 无法删除监控项 --> 链接的模板 --> 取消链接

选择自己创建的主机 --> 模板 --> 选择自己创建的模板 --> 添加 --> 更新 --> 可以预览到图形

12、zabbix 处理乱码
zabbix 字体库中没有需要的图形中文字体，需要从 windows 拷贝一个

$ vim /usr/share/zabbix/include/defines.inc.php //ZBX_FONTPATH
$ ll /usr/share/zabbix/fonts
# 将 windows 字体 c:\windows\fonts\simfang.ttf（仿宋简体） 上传到 linux /usr/share/zabbix/fonts/ 下，并改名为 graphfont.ttf
$ mv graphfont.ttf graphfont.ttf.bak //将原来的备份
$ ln -s simfang.ttf graphfont.ttf
13、添加自定义监控项目
需求：监控某台 web 的 80 端口田连接数，并出图

zabbix 监控中心创建监控项目脚本

针对该监控项目以图形展现

# 在客户端
$ vim /usr/local/sbin/establi.sh
 #!/bin/bash
 # 获取 80 端口并发连接数
 # netstat -ant 显示所有 tcp 网络连接的状态
 netstat -ant | grep ':80' | grep -c ESTABLISHED

$ chmod 755 /usr/local/sbin/establi.sh
$ vim /etc/zabbix/zabbix_agentd.conf
 UnsafeUserParameters=1 //表示使用自定义脚本
 UserParameter=my.establi.count[*],/usr/local/sbin/establi.sh
 //# 自定义监控项的 key 为 my.establi.count,后面的 [*] 里面写脚本参数，如没有参数可省略

$ systemctl restart zabbix-agent

# 到服务器验证
$ zabbix_get -s 192.168.95.11 -p 10050 -k 'my.establi.count'
# 到浏览器 zabbix 监控中心配置增加监控项目，键值写 my.establi.count
# 添加后到 ”监测中“ --> ”最新数据“ 查看是否有数据
# 有数据添加图形 配置 --> 主机 --> 图形 --> 创建图形
14、zabbix配置邮件告警
centos 6
yum install -y sendmail ;

mail -s “主题” ziluoxingjun@126.com < /etc/inittab

mailq（可查看是否发送成功）

mkdir -p /home/zabbix/bin
vim /home/zabbix/bin/baojing.sh //内容：
#! /bin/bash
echo “$3” |/bin/mail -s “$2” $1（$3 内容 $2 主题 $1 收件人）
chmod +x /home/zabbix/bin/baojing.sh
在zabbix_server.conf配置文件中，有参数AlertScriptsPath和ExternalScripts
AlertScriptsPath=/home/zabbix/bin/ —用户自定义的media types脚本
ExternalScripts=/home/zabbix/bin/ —用户自定义的检查的脚本（item）
这样才能找到你的脚本，因为你在frontend中只是输入脚本的名称，没有路径。
创建mediea types: “Administration" -->”Media types"，点击右上角“Create Media Type"其中Description填"baojing” 或其它自定义名称，Type选择"Script"，Script填”baojing.sh”然后点”Save”.
创建user: “Adimistration” --> “Users”在右上角，选择”Users”，点击”Create User”, alias: test1,自定义name和lastname password:123456;group 选择guest，回到上面点一下media,type 选择baojing，send to 写要发送邮件的邮箱，点add, 最后点save
创建action: “configuration” --> actions,右上角“Create Actions”, Name自定义，我这里写”baojing”,其他默认，然后点右侧的“Operations”下的“New”按钮，“Operation Type”选择“Send message”，“Send Message to”选择一个或多个要发送消息的用户组，Send to Users选择我们之前新增的test1, “Send only to”选择baojing , 点一下add
最后点save

centos 7
使用 126 邮箱测试，开启 pop3 imap smtp 服务，开启记录授权码
到浏览器监控中心设置邮件告警，管理 --> 报警媒介类型 – > 创建媒体类型 类型选择 脚本
参数 {ALERT.SENDTO} {ALERT.SUBJECT} {ALERT.MESSAGE}
# 创建报警脚本 mailto.py
$ vim /usr/lib/zabbix/alertscripts/mailto.py

$ chmod 755 /usr/lib/zabbix/alertscripts/mailto.py
# 创建一个接受告警邮件的用户：管理 --> 用户 --> 创建用户 --> 报警媒介 类型为 上面创建媒介的名称
# 注意用户的权限，要到用户群组去设置为读写
# 设置动作 配置 --> 动作 --> 创建动作 名称为 ”sendmail"
# 新的触发条件，A 维护状态 非在 维护 B 触发器示警度>=未分类
# 操作 消息内容：
HOST:{HOST.NAME} {HOST.IP}
TIME:{EVENT.DATE}  {EVENT.TIME} 
LEVEL:{TRIGGER.SEVERITY} 
NAME:{TRIGGER.NAME}
messages:{ITEM.NAME}:{ITEM.VALUE}
ID:{EVENT.ID}

# 操作 新的 --> 发送到用户 选择 创建的用户，仅送到 选择创建的报警媒介名称 条件为 事件已确认＝非确认
# 别忘了点 添加
# 恢复操作 信息内容如下：
HOST:{HOST.NAME} {HOST.IP}
TIME:{EVENT.DATE}  {EVENT.TIME} 
LEVEL:{TRIGGER.SEVERITY} 
NAME:{TRIGGER.NAME}
messages:{ITEM.NAME}:{ITEM.VALUE}
ID:{EVENT.ID}
# 发送到用户 仅送到 添加
15、Linux 安全
http://ask.apelearn.com/question/7207

内容概要：
\1. Linux发行版本
选择主流的，更新较快的。
从官网获取安装镜像
\2. 硬件和物理安全
设置bios密码
设置grub密码

grub-crypt （SHA）
vim /etc/grub.conf
password --sha asklfklsfjas;
设置系统密码
选择有安全保障的idc机房
\3. 系统和用户方面
关闭用不到的服务 (http://www.aminglinux.com/study_v2/chapter16.html#id5)
尽量升级到最新稳定版程序包
设置防火墙规则 (http://www.aminglinux.com/study_v2/chapter16.html#id3)
不需要登录的用户要禁止登录
root远程登录限制 ( http://www.aminglinux.com/bbs/thread-5546-1-1.html and http://www.aminglinux.com/bbs/thread-5545-1-1.html)
打开系统日志记录一切信息
配置合适的sudoer
\4. 文件系统安全 （参考 http://www.aminglinux.com/bbs/thread-6917-1-2.html）
使用ext3或者ext4
严格控制目录和文件的权限 umask
尽量少使用suid/sgid权限
重要的数据或配置文件要制定备份计划
\5. pam （参考资料 http://www.infoq.com/cn/articles/linux-pam-one）
/etc/pam.conf
/etc/pam.d/
pam类型
auth 用户验证相关 要求用户输入一个口令
account 用户账户管理相关 检查一个用户的账户或者口令是否过期
session 与连接或者会话管理相关 比如将用户登录会话信息记录到日志
password 密码管理
pam 级别
required：表示该行以及所涉及模块的成功是用户通过鉴别的必要条件。换句话说，只有当对应于应用程序的所有带 required标记的模块全部成功后，该程序才能通过鉴别。同时，如果任何带required标记的模块出现了错误，PAM并不立刻将错误消息返回给应用程序，而是在所有模块都调用完毕后才将错误消息返回调用他的程序。 反正说白了，就是必须将所有的模块都执行一次，其中任何一个模块验证出错，验证都会继续进行，并在执行完成之后才返回错误信息。这样做的目的就是不让用户知道自己被哪个模块拒绝，通过一种隐蔽的方式来保护系统服务。就像设置防火墙规则的时候将拒绝类的规则都设置为drop一样，以致于用户在访问网络不成功的时候无法准确判断到底是被拒绝还是目标网络不可达。
requisite：与required相仿，只有带此标记的模块返回成功后，用户才能通过鉴别。不同之处在于其一旦失败就不再执行堆中后面的其他模块，并且鉴别过程到此结束，同时也会立即返回错误信息。与上面的required相比，似乎要显得更光明正大一些。
sufficient： 表示该行以及所涉及模块验证成功是用户通过鉴别的充分条件。也就是说只要标记为sufficient的模块一旦验证成功，那么PAM便立即向应用程序返回成功结果而不必尝试任何其他模块。
optional： 他表示即便该行所涉及的模块验证失败用户仍能通过认证。
\6. 应用安全
各种常用服务 ftp、samba、nfs、rsync、mysql、http
web安全（漏洞：文件上传、xss、sql注入、CSRF、访问控制）
文件上传： 就像discuz论坛的图片上传，如果图片上传服务器时的目录可以执行php脚本，那么这就意味着，用户可以上传木马脚本，然后可以执行
xss：跨站脚本漏洞（Cross Site Scripting，常简写作XSS）是Web应用程序在将数据输出到网页的时候存在问题，导致攻击者可以将构造的恶意数据显示在页面的漏洞。因为跨站脚本攻击都是向网页内容中写入一段恶意的脚本或者HTML代码，故跨站脚本漏洞也被叫做HTML注入漏洞（HTML Injection）。
sql注入：所谓SQL注入，就是通过把SQL命令插入到Web表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。PHP + MYSQL编程，引发SQL注入攻击的主要原因有两点：（1） PHP配置文件php.ini中的magic_quotes_gpc选项没有打开，被设置为off。（2） 开发者没有对数据类型进行检查和转义。第二点最为重要，如果没有第二点的保证，magic_quotes_gpc选项不论为on，还是off，都可能引发SQL注入攻击。
CSRF： （Cross-site request forgery，跨站请求伪造）伪造用户的请求利用受信任的网站来做一些用户不知道的事。当用户访问网站通过登录操作会得到身份标识的cookie，在不关闭浏览器并未注销登录的情况下会带着cookie，这种状态下就有可能会让攻击者去伪造请求。因为CSRF不容易被发现，所以用户通常不容易察觉但是其危害性是很明显的。
访问控制：
apache配置：
apache的order allow deny http://www.aminglinux.com/bbs/thread-832-1-1.html
apache限制某个目录下的php文件没有执行权限 http://www.aminglinux.com/bbs/thread-1000-1-1.html
apache 针对访问uri 限制ip http://www.aminglinux.com/bbs/thread-5365-1-1.html
几种限制ip的方法 http://www.aminglinux.com/bbs/thread-6519-1-1.html
nginx配置
限制只让某个ip访问 http://www.aminglinux.com/bbs/thread-450-1-1.html
禁止通过ip访问站点 http://www.aminglinux.com/bbs/thread-38-1-1.html
禁止某个IP或者IP段访问站点的设置方法 http://www.aminglinux.com/bbs/thread-546-1-1.html
使用 user_agent 控制客户端访问 http://www.aminglinux.com/bbs/thread-846-1-1.html
\7. 入侵检测
snort （https://www.snort.org/）
snort中文手册： http://www.360doc.com/content/08/0114/14/25127_972488.shtml

http://man.chinaunix.net/network/snort/Snortman.htm

https://www.ibm.com/search/csass/search/?q=snort&sn=dw&lang=zh&cc=CN&en=utf&hpp=20&dws=cndw&lo=zh

http://www.phperz.com/special/102.html

10、Linux 调优

http://ask.apelearn.com/question/7237

调优目的是为了让系统更加高效，使系统资源使用达到最大的平衡。
参考资料：
http://os.51cto.com/art/201303/385726.htm（调优那些事）
http://www.111cn.net/sys/linux/58433.htm（io/系统/内存性能调优）
http://hong.im/2013/04/20/linux-tcp-tuning/ （高流量大并发Linux TCP 性能调优）
http://wenku.baidu.com/view/0985c9dba58da0116c1749ae.html （文库–LINUX性能调优方法总结）
http://my.oschina.net/sharelinux/blog?catalog=289503 （浅谈linux性能调优系列）
http://colobu.com/2014/09/18/linux-tcpip-tuning/ （TCP/IP协议栈）
https://blog.linuxeye.com/379.html（mysql调优）
http://www.tuicool.com/articles/RbUNn2 （nignx+php-fpm 高并发参数配置及linux内核参数优化）
http://blog.csdn.net/wangsg2014/article/details/38804873 （nignx参数优化）
http://os.51cto.com/art/201003/192112.htm （apache参数优化）
http://www.phpboy.net/apache/488.html（apache参数优化）
http://www.360doc.com/relevant/178008993_more.shtml （apache参数优化文档库）
http://www.cnblogs.com/R-zqiang/archive/2012/06/12/2545768.html (php.ini参数优化）
http://www.cnblogs.com/ggjucheng/archive/2013/04/16/3024731.html （tomcat调优）
http://www.php-oa.com/2008/02/03/squidyouhua.html （squid调优）
http://www.neters.cn/archives/548.html（squid优化指南）
http://handao.blog.techweb.com.cn/archives/134.html （squid优化相关的内核参数调整）
一. 硬件方面
\1. cpu
\2. 内存 （增加内存）
\3. 存储 （使用raid，使用ssd)
\4. 网卡 （使用千兆网卡，或者双网卡绑定）
二. 系统方面
\1. 内核参数优化（网络相关、内存相关、缓冲缓存相关）
\2. 文件系统方面（分区调优，格式化时根据存储文件特性，指定合适的块大小，noatime，日志隔离，软raid，有效使用/dev/shm，关闭不必要的服务）
\3. cpu优化 （进程绑定，中断绑定）
三. 应用程序方面
\1. nginx、apache、php-fpm、mysql、tomcat、squid等应用，是可以通过调节各个参数获得性能优化的。
\2. web优化，比如可以把用户请求合并（js、css合并），使用cdn加速静态页访问速度，把图片文档压缩减少带宽传输，
\3. 优化网站程序
四. 架构方面
\1. 使用简单并且稳定的架构方案
\2. 多使用缓存（squid,varnish,memcache,nosql相关：redis，mongodb)